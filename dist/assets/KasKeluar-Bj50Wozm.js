import{r as b,y as _,o as H,b as F,w as G,a as i,e as t,t as n,p as u,z as C,E as V,f as g,j as P,F as D,i as L,v as B,u as S,C as J,g as O}from"./index-CqU-N3Nx.js";import{a as x}from"./axios-2s9xPmg-.js";import{S as p}from"./sweetalert2.esm.all-B3GDCxSY.js";import{_ as q}from"./AdminLayout-wSIyYV-Y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"space-y-6"},Q={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},W={class:"bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-800 p-4 rounded-xl flex items-center gap-4"},X={class:"text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold"},Z={class:"text-xl font-bold text-red-600 mt-1"},ee={class:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-xl p-5 shadow-sm min-h-[500px]"},te={class:"flex flex-col md:flex-row justify-between items-end md:items-center gap-4 mb-6"},ae={class:"flex flex-col sm:flex-row gap-3 w-full md:w-auto"},re={class:"relative w-full sm:w-64"},le={class:"flex gap-2 w-full md:w-auto"},oe=["value"],se=["value"],ne={class:"flex gap-2"},de={class:"overflow-x-auto"},ie={class:"w-full text-left border-collapse"},ue={class:"border-b border-gray-100 dark:border-gray-800 text-gray-500 text-xs uppercase bg-gray-50 dark:bg-gray-800/50"},ge={class:"p-4 text-center"},pe={class:"divide-y divide-gray-100 dark:divide-gray-800"},ce={key:0},me={key:1},be={class:"p-4 text-sm text-gray-600 dark:text-gray-400"},xe={class:"p-4 text-sm font-medium text-gray-800 dark:text-white"},ke={class:"p-4 text-sm font-bold text-red-600"},ye={class:"p-4 text-sm font-bold dark:text-white"},he={class:"p-4 flex justify-center gap-2"},fe=["onClick"],ve=["onClick"],we={class:"flex justify-between items-center border-t border-gray-200 dark:border-gray-700 pt-4 mt-4"},_e={class:"text-sm text-gray-500"},Ce={class:"flex gap-2"},Pe=["disabled"],De=["disabled"],Be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm"},Se={class:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md shadow-2xl p-6"},Ie={class:"text-lg font-bold mb-4 text-gray-800 dark:text-white"},Me={class:"relative mt-1"},je=["value"],Te={class:"flex gap-3 pt-2"},Ue={__name:"KasKeluar",setup($e){const y=b(!1),m=b([]),h=b(""),f=b(0);let v=null;const w=localStorage.getItem("role"),z=localStorage.getItem("username"),d=_({bulan:new Date().getMonth()+1,tahun:new Date().getFullYear()}),l=_({currentPage:1,limit:10,totalData:0,totalPage:1}),I=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],k=b(!1),o=_({id:null,keperluan:"",tanggal_pengeluaran:"",total_pengeluaran:0,nama_penginput:z}),c=async()=>{y.value=!0;const r=localStorage.getItem("token");try{const e=await x.get("https://alentest.my.id/laporan/api/kas/keluar",{headers:{Authorization:`Bearer ${r}`},params:{bulan:d.bulan,tahun:d.tahun,page:l.currentPage,limit:l.limit,search:h.value}});m.value=e.data.data||[],e.data.pagination?(l.totalData=e.data.pagination.totalData,l.totalPage=e.data.pagination.totalPage,l.currentPage=e.data.pagination.currentPage):(l.totalData=m.value.length,l.totalPage=1,l.currentPage=1),e.data.summary?f.value=e.data.summary.total_keluar:f.value=0}catch{m.value=[]}finally{y.value=!1}},M=()=>{l.currentPage=1,c()},A=()=>{v&&clearTimeout(v),v=setTimeout(()=>{l.currentPage=1,c()},500)},j=r=>{r>=1&&r<=l.totalPage&&(l.currentPage=r,c())},T=(r,e=null)=>{k.value=!0,r==="edit"&&e?(o.id=e.id,o.keperluan=e.keperluan,o.tanggal_pengeluaran=e.tanggal_pengeluaran.split("T")[0],o.total_pengeluaran=e.total_pengeluaran):(o.id=null,o.keperluan="",o.tanggal_pengeluaran=new Date().toISOString().split("T")[0],o.total_pengeluaran=0)},U=async()=>{var e,a;const r=localStorage.getItem("token");try{o.id?(await x.put(`https://alentest.my.id/laporan/api/kas/keluar/${o.id}`,o,{headers:{Authorization:`Bearer ${r}`}}),p.fire("Sukses","Data diperbarui","success")):(await x.post("https://alentest.my.id/laporan/api/kas/keluar",o,{headers:{Authorization:`Bearer ${r}`}}),p.fire("Sukses","Pengeluaran dicatat","success")),k.value=!1,c()}catch(s){p.fire("Gagal",((a=(e=s.response)==null?void 0:e.data)==null?void 0:a.message)||"Error","error")}},N=async r=>{if((await p.fire({title:"Yakin hapus data ini?",text:"Data tidak dapat dikembalikan",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus"})).isConfirmed){const a=localStorage.getItem("token");try{await x.delete(`https://alentest.my.id/laporan/api/kas/keluar/${r}`,{headers:{Authorization:`Bearer ${a}`}}),p.fire("Terhapus","Data berhasil dihapus","success"),c()}catch{p.fire("Gagal","Terjadi kesalahan","error")}}},R=async()=>{try{const r=localStorage.getItem("token"),e=await x.get("https://alentest.my.id/laporan/api/kas/download/excel",{params:{bulan:d.bulan,tahun:d.tahun},headers:{Authorization:`Bearer ${r}`},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=a,s.setAttribute("download",`Laporan_Pengeluaran_${d.bulan}-${d.tahun}.xlsx`),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}catch{p.fire("Gagal","Gagal mengunduh laporan excel","error")}},$=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r),K=r=>r?r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):"",E=(r,e,a)=>{let s=r.target.value.replace(/\D/g,"");e[a]=s?parseInt(s):0,r.target.value=K(e[a])};return H(()=>{c()}),(r,e)=>(i(),F(q,null,{default:G(()=>[t("div",Y,[t("div",Q,[e[11]||(e[11]=t("div",null,[t("h2",{class:"text-2xl font-bold text-gray-800 dark:text-white"},"Data Pengeluaran"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Kelola arus kas keluar operasional.")],-1)),t("div",W,[e[10]||(e[10]=t("div",{class:"p-3 bg-red-100 dark:bg-red-800 rounded-full text-red-600 dark:text-red-200"},[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"})])],-1)),t("div",null,[t("p",X,"Total Keluar ("+n(I[d.bulan-1])+")",1),t("h3",Z,n($(f.value)),1)])])]),t("div",ee,[t("div",te,[t("div",ae,[t("div",re,[e[12]||(e[12]=t("span",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[t("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),onInput:A,type:"text",placeholder:"Cari Keperluan...",class:"w-full pl-9 pr-4 py-2 border rounded-lg text-sm focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"},null,544),[[C,h.value]])]),t("div",le,[u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.bulan=a),onChange:M,class:"block w-full md:w-32 px-3 py-2 border rounded-lg text-sm focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"},[(i(),g(D,null,P(I,(a,s)=>t("option",{key:s,value:s+1},n(a),9,oe)),64))],544),[[V,d.bulan]]),u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>d.tahun=a),onChange:M,class:"block w-full md:w-24 px-3 py-2 border rounded-lg text-sm focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"},[(i(),g(D,null,P([2023,2024,2025,2026],a=>t("option",{key:a,value:a},n(a),9,se)),64))],544),[[V,d.tahun]])])]),t("div",ne,[t("button",{onClick:R,class:"flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition whitespace-nowrap"},e[13]||(e[13]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),L(" Excel ")])),u(t("button",{onClick:e[3]||(e[3]=a=>T("add")),class:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap"},e[14]||(e[14]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),L(" Catat Pengeluaran ")]),512),[[B,S(w)==="admin"]])])]),t("div",de,[t("table",ie,[t("thead",null,[t("tr",ue,[e[15]||(e[15]=t("th",{class:"p-4"},"Tanggal",-1)),e[16]||(e[16]=t("th",{class:"p-4"},"Keperluan",-1)),e[17]||(e[17]=t("th",{class:"p-4"},"Nominal",-1)),e[18]||(e[18]=t("th",{class:"p-4"},"Penginput",-1)),u(t("th",ge,"Aksi",512),[[B,S(w)==="admin"]])])]),t("tbody",pe,[y.value?(i(),g("tr",ce,e[19]||(e[19]=[t("td",{colspan:"5",class:"p-6 text-center text-gray-500"},"Memuat data...",-1)]))):m.value.length===0?(i(),g("tr",me,e[20]||(e[20]=[t("td",{colspan:"5",class:"p-6 text-center text-gray-500"},"Belum ada data pengeluaran.",-1)]))):(i(!0),g(D,{key:2},P(m.value,a=>(i(),g("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800/30"},[t("td",be,n(new Date(a.tanggal_pengeluaran).toLocaleDateString("id-ID")),1),t("td",xe,n(a.keperluan),1),t("td",ke,n($(a.total_pengeluaran)),1),t("td",ye,n(a.nama_penginput),1),u(t("td",he,[t("button",{onClick:s=>T("edit",a),class:"text-blue-500 hover:bg-blue-50 p-1.5 rounded"},e[21]||(e[21]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,fe),t("button",{onClick:s=>N(a.id),class:"text-red-500 hover:bg-red-50 p-1.5 rounded"},e[22]||(e[22]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,ve)],512),[[B,S(w)==="admin"]])]))),128))])])]),t("div",we,[t("div",_e,"Halaman "+n(l.currentPage)+" dari "+n(l.totalPage)+" (Total "+n(l.totalData)+" Data)",1),t("div",Ce,[t("button",{onClick:e[4]||(e[4]=a=>j(l.currentPage-1)),disabled:l.currentPage<=1,class:"px-3 py-1 text-sm border rounded hover:bg-gray-100 disabled:opacity-50 dark:text-white dark:hover:bg-blue-400"},"Prev",8,Pe),t("button",{onClick:e[5]||(e[5]=a=>j(l.currentPage+1)),disabled:l.currentPage>=l.totalPage,class:"px-3 py-1 text-sm border rounded hover:bg-gray-100 disabled:opacity-50 dark:text-white dark:hover:bg-blue-400"},"Next",8,De)])])]),k.value?(i(),g("div",Be,[t("div",Se,[t("h3",Ie,n(o.id?"Edit Pengeluaran":"Catat Pengeluaran"),1),t("form",{onSubmit:J(U,["prevent"]),class:"space-y-4"},[t("div",null,[e[23]||(e[23]=t("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Keperluan",-1)),u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.keperluan=a),type:"text",class:"w-full mt-1 p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:"",placeholder:"Contoh: Beli Lampu Jalan"},null,512),[[C,o.keperluan]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Tanggal",-1)),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>o.tanggal_pengeluaran=a),type:"date",class:"w-full mt-1 p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:""},null,512),[[C,o.tanggal_pengeluaran]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Total Biaya (Rp)",-1)),t("div",Me,[e[25]||(e[25]=t("span",{class:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 dark:text-gray-400"},"Rp",-1)),t("input",{type:"text",value:K(o.total_pengeluaran),onInput:e[8]||(e[8]=a=>E(a,o,"total_pengeluaran")),class:"w-full pl-10 p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:""},null,40,je)])]),t("div",Te,[t("button",{type:"button",onClick:e[9]||(e[9]=a=>k.value=!1),class:"flex-1 py-2 border rounded-lg text-gray-600 hover:bg-gray-50 dark:text-white dark:hover:text-black"},"Batal"),e[27]||(e[27]=t("button",{type:"submit",class:"flex-1 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium"},"Simpan",-1))])],32)])])):O("",!0)])]),_:1}))}};export{Ue as default};
